---
import FormattedDate from "@/components/FormattedDate.astro";
import { getAllPosts, sortMDByDate } from "@/data/post";
import { getCollection } from "astro:content";
import { Icon } from "astro-icon/components";

async function getAllLabNotes() {
	const allLabNotes = await getCollection("labNotes");
	return allLabNotes;
}

// const MAX_POSTS = 10;
// const allPosts = await getAllPosts();
// const allPostsByDate = sortMDByDate(allPosts).slice(0, MAX_POSTS);

const allLabNotes = await getAllLabNotes();

const dateTimeOptions: Intl.DateTimeFormatOptions = {
	month: "long",
};
---

<div class="h-full outline outline-2 outline-black/10 ring-1 ring-inset ring-gray-900/10">
	<div class="sticky left-0 top-0">
		<div class="shadow-md ring-1 ring-inset ring-gray-900/10">
			<div class="flex w-full flex-col items-center justify-between bg-bgColour-muted">
				<Icon class="size-24" name="flask" />
				<div
					class="flex w-full flex-row items-center justify-center py-2 align-middle backdrop-blur-md"
				>
					<h2 class="p-0">Lab Notes</h2>
				</div>
			</div>
		</div>
	</div>
	<div class="flex overflow-y-scroll">
		<ul>
			{
				allLabNotes.map(async (note) => {
					const { Content } = await note.render();
					return (
						<li>
							<div class="flex flex-col">
								<div class="grid w-full grid-cols-3 gap-2">
									<div class="col-span-full grid grid-cols-3 gap-2 bg-pink-300">
										<div class="col-span-1 flex w-fit items-center rounded-br-lg bg-red-100 px-2 py-1 pr-3">
											<span class="font-maisonNeueMono font-bold text-fgColour-accent">
												{note.data.experiment}
											</span>
										</div>
										<div class="col-span-3">
											<div class="p-2">
												<div class="break-words">
													<h3>{note.data.title}</h3>
												</div>

												<p>
													<FormattedDate
														date={note.data.publishDate}
														dateTimeOptions={dateTimeOptions}
													/>
												</p>
											</div>
										</div>
									</div>
									<div class="col-span-3 p-2">
										<div class="prose prose-kwicherbelliaken">
											<Content />
										</div>
									</div>
								</div>
							</div>
						</li>
					);
				})
			}
		</ul>
	</div>
</div>
