---
import compositionNotebook from "@/assets/composition-notebook.jpg";
import FormattedDate from "@/components/FormattedDate.astro";
import { getAllPosts, sortMDByDate } from "@/data/post";
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import { Icon } from "astro-icon/components";

async function getAllLabNotes() {
	const allLabNotes = await getCollection("labNotes");
	return allLabNotes;
}

// #d5d7c1

// const MAX_POSTS = 10;
// const allPosts = await getAllPosts();
// const allPostsByDate = sortMDByDate(allPosts).slice(0, MAX_POSTS);

const allLabNotes = await getAllLabNotes();

const dateTimeOptions: Intl.DateTimeFormatOptions = {
	month: "long",
};
---

<div class="h-full border-l-2 border-l-black/10">
	<div class="sticky left-0 top-0">
		<div class="shadow-md">
			<div class="relative border-l-[2rem] border-l-black">
				<Image
					alt="A composition notebook"
					class="h-full"
					loading="eager"
					src={compositionNotebook}
				/>
				<div class="absolute left-1/2 top-1/2 z-10 -translate-x-1/2 -translate-y-1/2">
					<div class="rounded-md bg-[#d5d7c1] py-3 px-5 border border-black/30 shadow-md">
						<div class="flex w-full flex-col items-center justify-between gap-2">
							<Icon class="size-10 text-black/90" name="flask" />
							<div class="flex w-full flex-row items-center justify-center py-1 align-middle border-t border-black/20">
								<h2 class="p-0 font-maisonNeueMono font-bold text-sm uppercase tracking-wider text-black/90">Laboratory Notes</h2>
							</div>
						</div>
						<div class="mt-3 pt-2 border-t border-black/20 text-xs">
							<div class="flex justify-between font-maisonNeueMono">
								<span class="font-bold">Researcher:</span>
								<span>K. Belliaken</span>
							</div>
							<div class="flex justify-between mt-1.5 font-maisonNeueMono">
								<span class="font-bold">Classification:</span>
								<span>Experimental</span>
							</div>
							<div class="flex justify-between mt-1.5 font-maisonNeueMono">
								<span class="font-bold">Date:</span>
								<span>2023-Present</span>
							</div>
							<div class="mt-2 pt-1 border-t border-black/20 text-center font-maisonNeueMono text-2xs">
								<span class="italic">CONFIDENTIAL RESEARCH MATERIAL</span>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- <div class="flex w-full flex-col items-center justify-between">
				<Icon class="size-24" name="flask" />
				<div class="flex w-full flex-row items-center justify-center py-2 align-middle">
					<h2 class="p-0">Lab Notes</h2>
				</div>
			</div> -->
		</div>
	</div>
	<div class="flex overflow-y-scroll">
		<ul>
			{
				allLabNotes.map(async (note) => {
					const { Content } = await note.render();
					return (
						<li>
							<div class="flex flex-col">
								<div class="grid w-full grid-cols-3 gap-2">
									<div class="col-span-full grid grid-cols-3 gap-2">
										<div class="col-span-1 flex w-fit items-center rounded-br-lg border-[1px] border-black/10 bg-fgColour-default/20 px-2 py-1 pr-3">
											<span class="font-maisonNeueMono font-bold">{note.data.experiment}</span>
										</div>
										<div class="col-span-3">
											<div class="p-2">
												<div class="break-words">
													<h3>{note.data.title}</h3>
												</div>

												<p class="text-fgColour-muted/60">
													<FormattedDate
														date={note.data.publishDate}
														dateTimeOptions={dateTimeOptions}
													/>
												</p>
											</div>
										</div>
									</div>
									<div class="col-span-3 p-2">
										<div class="prose prose-kwicherbelliaken">
											<Content />
										</div>
									</div>
								</div>
							</div>
						</li>
					);
				})
			}
		</ul>
	</div>
</div>
